# Directive trong Angular
## 1. Giới thiệu
Directive trong Angular là một phần quan trọng giúp mở rộng khả năng của HTML bằng cách thêm các hành vi tùy chỉnh cho các phần tử DOM. Chúng cho phép bạn tạo ra các thành phần có thể tái sử dụng và dễ dàng quản lý.

> Lưu ý nếu `directive` không được khai báo là `standalone`, bạn cần phải thêm nó vào `@NgModule` trong file module tương ứng.

## 2. Các loại Directive
Angular hỗ trợ ba loại directive chính:

1. **Component Directives**: Là các directive có template riêng và được sử dụng để tạo ra các thành phần UI.
2. **Structural Directives**: Là các directive thay đổi cấu trúc của DOM bằng cách thêm hoặc xóa các phần tử. Ví dụ: `*ngIf`, `*ngFor`.
3. **Attribute Directives**: Là các directive thay đổi thuộc tính của một phần tử DOM mà không thay đổi cấu trúc của nó. Ví dụ: `ngClass`, `ngStyle`.

## 3. Cú pháp tạo Directive

Để tạo một directive trong Angular, bạn có thể sử dụng cú pháp sau:
```bash
ng generate directive <tên-directive>
```

## 4. Ví dụ
### 4.1. Attribute Directive
> Ví dụ thêm `attribute directive` vào thẻ `<a>` để thêm xác nhận khi người dùng nhấp vào liên kết, đồng thời thêm tham số truy vấn vào địa chỉ liên kết
```ts
import { Directive, ElementRef, inject, input } from "@angular/core";

@Directive({
  selector: "a[appSafeLink]",
  standalone: true,
  host: {
    "(click)": "confirmToLeave($event)",
  },
})
export class SafeLinkDirective {
  queryParam = input("", { alias: "appSafeLink" }); // Tạo input với giá trị mặc định là "" và có attribute chính là "appSafeLink" để trong template có thể sử dụng luôn bằng cách <tên directive> = "<giá trị>"

  private hostElementRef = inject<ElementRef<HTMLAnchorElement>>(ElementRef); // Lấy tham chiếu đến phần tử host (ở đây là thẻ <a>)
  constructor() {
    console.log("SafeLinkDirective initialized");
  }

  confirmToLeave(event: MouseEvent) {
    const isConfirm = window.confirm("Do you want to leave this page?"); // Hiển thị hộp thoại xác nhận

    if (isConfirm) {
      // const address = (event.target as HTMLAnchorElement).href; // Lấy địa chỉ liên kết mà người dùng muốn truy cập khi nhấp vào
      // (event.target as HTMLAnchorElement).href =
      //   address + "?form=" + this.queryParam(); // Thêm tham số truy vấn vào địa chỉ liên kết

      const address = this.hostElementRef.nativeElement.href; // Lấy địa chỉ liên kết mà người dùng muốn truy cập khi nhấp vào
      this.hostElementRef.nativeElement.href =
        address + "?form=" + this.queryParam(); // Thêm tham số truy vấn vào địa chỉ liên kết

      return;
    } // Người dùng xác nhận, cho phép chuyển hướng

    event.preventDefault(); // Ngăn chặn chuyển hướng
  }
}


```
```html
<a href="https://angular.dev" appSafeLink="myapp">Angular Documentation</a>
```

### 4.2. Structural Directive
Một số thuật ngữ khi sử dụng `structural directive` trong Angular:

- **ng-template**: Là một phần tử đặc biệt trong Angular, cho phép bạn định nghĩa một khối mã HTML mà chỉ được hiển thị khi điều kiện cho trước là đúng.
- **ng-container**: Là một phần tử không tạo ra bất kỳ phần tử DOM nào, thường được sử dụng để nhóm các phần tử lại với nhau mà không làm thay đổi cấu trúc DOM.

> Ví dụ tạo `structural directive` để hiển thị nội dung chỉ dành cho người dùng có vai trò là "admin"
```ts
import {
  Directive,
  effect,
  inject,
  input,
  TemplateRef,
  ViewContainerRef,
} from "@angular/core";
import { AuthService } from "./auth.service";
import { Permission } from "./auth.model";

@Directive({
  selector: "[appAuth]",
  standalone: true,
})
export class AuthDirective {
  private authService = inject(AuthService);
  userType = input.required<Permission>({ alias: "appAuth" });
  hostTemplateRef = inject(TemplateRef); // Tham chiếu đến TemplateRef của thẻ <ng-template>
  viewContainerRef = inject(ViewContainerRef); // Tham chiếu đến ViewContainerRef (các phần tử con) của thẻ <ng-template>
  constructor() {
    effect(() => {
      if (this.authService.activePermission() === this.userType()) {
        console.log("Render Element");
        this.viewContainerRef.createEmbeddedView(this.hostTemplateRef); // Hiển thị phần tử con bên trong thẻ <ng-template>
      } else {
        console.log("Do Not Render Element");
        this.viewContainerRef.clear(); // Xóa phần tử con bên trong thẻ <ng-template> nếu điều kiện không đúng
      }
    });
  }
}
```
```html
<ng-template appAuth="admin">
  <p>Only visible to admin users</p>
</ng-template>
```
