# Làm việc với Form trong Angular
## 1. Giới thiệu
Angular cung cấp hai cách để làm việc với form: Template-driven và Reactive.
- `Template-driven form` là cách tiếp cận đơn giản, dễ sử dụng cho các form nhỏ.
- `Reactive form` cung cấp nhiều tính năng mạnh mẽ hơn, phù hợp cho các form phức tạp.

## 2. So sánh
| Tiêu chí         | Template-driven form                | Reactive form                       |
|------------------|-------------------------------------|-------------------------------------|
| Cách tiếp cận    | Dựa trên template                   | Dựa trên mã nguồn                   |
| Quản lý trạng thái| Tự động, thông qua ngữ cảnh       | Thủ công, thông qua FormGroup     |
| Tính linh hoạt    | Ít linh hoạt hơn                    | Rất linh hoạt                       |
| Kiểm tra hợp lệ   | Dễ dàng, nhưng hạn chế              | Phức tạp hơn, nhưng mạnh mẽ hơn    |
| Tính mở rộng      | Khó mở rộng cho các form phức tạp  | Dễ dàng mở rộng                     |

## 3. Template-driven Form
- Làm việc với template-driven form trong Angular rất đơn giản. Bạn chỉ cần sử dụng các directive như `ngModel` để liên kết dữ liệu giữa form và component.
- Ví dụ:
```html
<form #myForm="ngForm" (ngSubmit)="onSubmit(myForm)"> <!-- Lấy tham chiếu đến form và xử lý sự kiện submit -->
  <input type="text" name="username" ngModel required> <!-- Liên kết dữ liệu 2 chiều giữa input và component -->
  <button [disabled]="myForm.invalid">Submit</button>
</form>
```
```ts
import { Component } from '@angular/core';
import { NgForm, FormModules } from '@angular/forms';

@Component({
  selector: 'app-template-driven-form',
  templateUrl: './template-driven-form.component.html',
  providers: [FormsModule]
})
export class TemplateDrivenFormComponent {
  onSubmit(formModal: NgForm) {
    console.log(formModal.form.value); // { username: '...' }
  }
}
```

> Lưu ý khi sử dụng `ngModel`: 
- Chỉ sử dụng trong các form template-driven, không sử dụng trong reactive form.
- `ngForm` giúp quản lý trạng thái của form và cung cấp thông tin về tính hợp lệ của form.
- Khi sử dụng `ngModel`, `ngSubmit` cần import thêm `FormsModule` trong module chứa component.
- `ngModel` chỉ hỗ trợ trong các thẻ `<input>`, `<select>`, và `<textarea>`, và muốn liên kết được cần thêm thuộc tính `name` vào các thẻ này. Giá trị của `ngModel` sẽ được đồng bộ hóa với giá trị của input.
- Có thể không cần sử dụng `ngForm`, chỉ sử dụng `ngModel` với ý nghĩa tạo ra liên kết 2 chiều giữa input và component. `[(ngModel)]` là cú pháp viết tắt của `ngModel` và `ngModelChange`, giúp đồng bộ hóa giá trị giữa input và component. Giá trị của thuộc tính `name` cũng chính là biến trong component.

### 3.1. Validate form
- Đối với template-driven form, Angular cung cấp các directive để kiểm tra tính hợp lệ của form như `required`, `minlength`, `maxlength`, `pattern`, v.v. bằng cách thêm các thuộc tính này vào các thẻ `<input>`, `<select>`, và `<textarea>`.
- Cùng với đó, Angular cũng cung cấp các class CSS để hiển thị trạng thái hợp lệ của form như (chúng ta sử dụng các class này để style css):
  - `ng-valid` - trạng thái hợp lệ
  - `ng-invalid` - trạng thái không hợp lệ
  - `ng-pristine` - trạng thái chưa thay đổi (người dùng chưa nhập gì)
  - `ng-dirty` - trạng thái đã thay đổi.
  - `ng-touched` - trạng thái đã được người dùng tương tác (focus và blur).
  - `ng-submitted` - trạng thái đã được gửi (submit).
  - `ng-untouched` - trạng thái chưa được người dùng tương tác.

- Kết hợp với các class này, bạn có thể sử dụng các thuộc tính như `.valid`, `.invalid`, `.pristine`, `.dirty`, `.touched`, `.untouched`, và `.submitted` để kiểm tra trạng thái của form trong component, bằng cách tham chiếu đến các biến template này gán với `ngModel`

```html
<form #myForm="ngForm" (ngSubmit)="onSubmit(myForm)">
  <input type="email" name="email" ngModel required #email="ngModel">
  <input type="password" name="password" ngModel required minlength="6" #password="ngModel">
  <button [disabled]="myForm.invalid">Submit</button>
</form>

@ if (email.touched && email.dirty && email.invalid) { // Nếu trường email đã được người dùng tương tác và thay đổi, và không hợp lệ
  // Hiển thị thông báo lỗi cho email
  <p>Email không hợp lệ</p>
}

@ if (password.touched && password.dirty && password.invalid) { // Nếu trường password đã được người dùng tương tác và thay đổi, và không hợp lệ
  // Hiển thị thông báo lỗi cho password
  <p>Password không hợp lệ</p>
}
```